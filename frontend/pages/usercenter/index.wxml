<!-- /pages/usercenter/index.wxml -->

<view class="profile-page">
  <!-- 用户信息卡片 -->
  <view class="user-card">
    <!-- 用户头像 -->
    <image class="user-avatar" src="{{userInfo.avatar || 'https://cloud.tsinghua.edu.cn/f/9a5d8ec171fa4541a9f4/?dl=1'}}" />

    <!-- 用户名 -->
    <view class="user-name">{{userInfo.nickname || 'Anonymous'}}</view>

    <!-- 用户格言 -->
    <text class="user-motto">{{userInfo.personality_description || 'Live and let live.'}}</text>
  </view>

  <view class="settings-section">
    <view class="settings-item" bindtap="goToLikes">My likes</view>
  </view>

  <!-- 饮食偏好选择区域 -->
  <view class="dietary-section">
    <!-- 宗教信仰选择 -->
    <view class="picker-container">
      <text class="picker-label">Religious Belief:</text>
      <picker mode="selector" range="{{religiousBeliefs}}" bindchange="onReligiousChange">
        <view class="picker">
          {{selectedReligiousBelief || 'Select your religious belief'}}
        </view>
      </picker>
    </view>

    <!-- 饮食偏好选择按钮 -->
    <view class="picker-container">
      <button class="select-dietary-button" bindtap="openDietaryModal">Dietary Preferences</button>
      <text> (Click to Select):</text>

      <!-- Display Selected Dietary Preferences as Tags -->
      <view class="selected-dietary-restrictions">
        <block wx:for="{{selectedDietaryPreferences}}" wx:key="*this">
          <view class="preference-tag">
            <text class="restriction-tag {{dietaryPreferencesMap[item.tag] === 'LIKE' ? 'tag-like' : (dietaryPreferencesMap[item.tag] === 'DISLIKE' ? 'tag-dislike' : '')}}">{{item.tag}}</text>
            <button class="clear-button" data-tag="{{item.tag}}" bindtap="clearPreference">✕</button>
          </view>
        </block>
        <block wx:if="{{selectedDietaryPreferences.length === 0}}">
          <text class="placeholder-text">No dietary preferences selected</text>
        </block>
      </view>
    </view>
  </view>

  <!-- Modal for Dietary Preferences -->
  <view wx:if="{{showDietaryModal}}" class="modal-overlay">
    <view class="modal">
      <view class="modal-header">
        <text class="modal-title">Select Dietary Preferences</text>
        <button class="close-button" bindtap="closeDietaryModal">✕</button>
      </view>
      <view class="modal-body">
        <!-- 新增一行表头 -->
        <view class="preference-header">
          <text class="item-header"></text>
          <view class="like-header">Only</view>
          <view class="dislike-header">Forbid</view>
          <view class="clear-header"></view>
        </view>
        <block wx:for="{{dietaryRestrictions}}" wx:key="*this">
          <view class="preference-item">
            <view class="item-column">
              <text class="checkbox-text">{{item}}</text>
            </view>
            <radio-group class="radio-group" data-tag="{{item}}" bindchange="onPreferenceChange">
              <view class="like-column">
                <label class="radio-label">
                  <radio value="LIKE" checked="{{dietaryPreferencesMap[item] === 'LIKE'}}"></radio>
                </label>
              </view>
              <view class="dislike-column">
                <label class="radio-label">
                  <radio value="DISLIKE" checked="{{dietaryPreferencesMap[item] === 'DISLIKE'}}"></radio>
                </label>
              </view>
            </radio-group>
            <view class="clear-column">
              <button class="clear-button" data-tag="{{item}}" bindtap="clearPreferenceItem">✕</button>
            </view>
          </view>
        </block>
      </view>
      <view class="modal-footer">
        <button class="save-button" bindtap="onSaveDietaryPreferences">Save</button>
      </view>
    </view>
  </view>

  <!-- 设置和其他操作 -->
  <view class="settings-section">
    <view class="settings-item" bindtap="goToSetting">Settings</view>
    <view class="settings-item" bindtap="onQuitAccount">Quit this account</view>
    <view class="settings-item" bindtap="onClearCookies">Clear all cookies</view>
    <view class="settings-item">
      <text>Version</text>
      <text class="version-text">v1.0 beta5</text>
    </view>
  </view>
</view>